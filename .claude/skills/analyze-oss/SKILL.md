---
name: analyze-oss
description: Analyze the architecture of an open source project and generate a report. Use when the user asks to analyze, research, or document an OSS project's architecture.
argument-hint: "[owner/repo or project-name]"
disable-model-invocation: false
allowed-tools: Bash(gh:*), WebSearch, WebFetch, Read, Write, Glob, Grep
---

# OSS Architecture Analyzer

Analyze the architecture of the given OSS project and generate a report under `oss/`.

Target: $ARGUMENTS

## Step 1: Identify the repository

- If the argument looks like `owner/repo`, use it directly as the GitHub repository.
- Otherwise, search GitHub to find the correct repository: `gh search repos "$ARGUMENTS" --limit 5`
- Confirm the repository URL before proceeding.

## Step 2: Gather project metadata

Run these commands to collect basic info:

```
gh repo view {owner/repo} --json name,description,licenseInfo,primaryLanguage,stargazerCount,url
gh release list -R {owner/repo} --limit 1
```

## Step 3: Research the architecture

Use multiple sources to deeply understand the project's architecture. Spend significant effort here — the quality of the report depends on thorough research.

1. Read the repository's README, ARCHITECTURE.md, CONTRIBUTING.md, and any design docs:
   - `gh api repos/{owner/repo}/contents/README.md -q .content | base64 -d`
   - Check for ARCHITECTURE.md, DESIGN.md, docs/ directory, etc.

2. Explore the source tree to understand the structure:
   - `gh api repos/{owner/repo}/git/trees/HEAD?recursive=1 -q '.tree[].path'` (filter to key directories)

3. Search the web for architecture articles, blog posts, and talks:
   - Use WebSearch for "{project name} architecture", "{project name} design", "{project name} internals"

4. Check DeepWiki for existing analysis:
   - Use WebFetch on `https://deepwiki.com/{owner/repo}`

5. Use Context7 MCP to query the latest documentation if available.

6. Read key source files to understand:
   - Entry points (main.go, main.rs, src/index.ts, etc.)
   - Core abstractions and interfaces
   - Plugin/extension mechanisms
   - Data flow patterns

## Step 4: Create the directory

```
mkdir -p oss/{project-name}
```

Use the lowercase project name (e.g., `trivy`, `prometheus`, `kubernetes`).

## Step 5: Write the report

Read the template at `oss/_template/README.md` and the example report at `oss/trivy/README.md` for reference.

Write the report to `oss/{project-name}/README.md` following these rules:

- Write entirely in English
- Follow the template structure exactly — all sections are required
- Fill in the metadata table with real data from Step 2
- Set "Category" to one of: Container Runtime, Container Orchestration, Security, Networking, Monitoring, Database, GitOps, IaC, Cloud Platform, Runtime, Web Framework, Build Tool, Data Processing, Editor / Terminal, Developer Tool, Desktop Application, Blockchain, Workflow Engine, Search Engine, Game Engine, Document Processor, Static Site Generator, CLI Tool, Web Server
- Set "Generated by" to the model you are running as (e.g., "Claude Opus 4.6 (Anthropic)")
- Set "Generated on" to today's date
- Mermaid diagrams are required for: Architecture Overview, Data Flow, and Dependencies
- Architecture Overview: Use `graph TB` showing major layers/components
- Data Flow: Use `sequenceDiagram` for the most representative use case
- Dependencies: Use `graph LR` showing core, libraries, and ecosystem
- Core Components: Document at least 3-5 major components with responsibility, key files, and design patterns
- Key Design Decisions: Document at least 3-5 decisions with choice, rationale, and trade-offs
- Key Takeaways: Extract at least 3 design insights that are broadly applicable
- Do NOT use markdown bold syntax (`**`) anywhere in the report
- Be specific — reference actual file paths, function names, and module names from the source code
- Prioritize accuracy. If uncertain about implementation details, note it rather than guessing

## Step 6: Clean up cloned repositories

CRITICAL: If you cloned any repository during the analysis (e.g., `gh repo clone`, `git clone`), you MUST delete it before finishing. Cloned repositories must NEVER be left in the workspace. Run `rm -rf {cloned-directory}` for every repository you cloned. Failure to clean up is unacceptable — always verify with `find` that no `.git` directories remain outside of the project root.

## Step 7: Verify

- Read back the generated file and verify all sections are complete
- Ensure all Mermaid diagrams have valid syntax
- Ensure no `{placeholder}` text remains
- Ensure no `**bold**` markdown is used
- Ensure no cloned repositories remain in the workspace
